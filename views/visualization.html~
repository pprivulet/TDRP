{% extends 'layout.html' %}



{% block content %}
 <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
    <div class="row">
        <h4 class="sub-header"><strong>Traffic Data Visualization</strong></h4>
        <div class="alert alert-info" role="alert"><span class="glyphicon glyphicon-hand-right"></span> 单击鼠标左键，拖动形成矩形框，框出目标区域后，设定时间段。</div>
    </div>    
          
    <div class="row"> 
        <div class="well" style="margin-top:-15px;height:860px;">
            <div id="i-map" style="width: 100%; height:100%"></div>
        </div>    
    </div>
</div>
{% endblock %}

{% block map %}
    <script type="text/javascript">      
  
        var map = new BMap.Map("i-map");      //设置卫星图为底图
        var point = new BMap.Point(120.645,31.144);
        map.centerAndZoom(point,16);//设定地图的中心点和坐标并将地图显示在地图容器中
        map.addControl(new BMap.NavigationControl());      //为地图添加鱼骨  
        map.enableScrollWheelZoom();//启用地图滚轮放大缩

        
        
        
        var sContent =
	    "<div class='alert alert-warning'>" +
	    "<h4>Event 1</h4><hr/>" + 
	    "<div class='row'><img class='col-xs-2 col-md-4' id='imgDemo' src='http://app.baidu.com/map/images/tiananmen.jpg'  title='天安门'/>" + 
	    "<p class='col-xs-2 col-md-4'>天安门坐落在中国北京市中心,故宫的南侧,与天安门广场隔长安街相望,是清朝皇城的大门...</p>" + 
	    "</div></div>"+
	    "<div class='alert alert-danger'>" +
	    "<h4 >Event 2</h4><hr/>" + 
	    "<div class='row'><img class='col-xs-2 col-md-4' id='imgDemo' src='http://app.baidu.com/map/images/tiananmen.jpg'  title='天安门'/>" + 
	    "<p class='col-xs-2 col-md-4'>天安门坐落在中国北京市中心,故宫的南侧,与天安门广场隔长安街相望,是清朝皇城的大门...</p>" + 
	    "</div></div>"
	    var point0 = new BMap.Point(120.662445+0.0005,31.152545+0.0005);
	    //var marker = new BMap.Marker(point0);
	    var myIcon = new BMap.Icon("/image/expired.png", new BMap.Size(25,25));
	    var marker = new BMap.Marker(point0,{icon:myIcon});  // 创建标注
	    //map.addOverlay(marker2); 
	     var opts = {
	  width : 550     // 信息窗口宽度
	      // 信息窗口高度
	 
	}
	    var infoWindow = new BMap.InfoWindow(sContent,opts);  // 创建信息窗口对象
	    
	   
	    
	    map.addOverlay(marker);
	    marker.addEventListener("click", function(){          
	        this.openInfoWindow(infoWindow);
	        //图片加载完毕重绘infowindow
	        document.getElementById('imgDemo').onload = function (){
		        infoWindow.redraw();   //防止在网速较慢，图片未加载时，生成的信息框高度比图片的总高度小，导致图片部分被隐藏
	        }
	    });
	    var points =[{"lng":120.662445,"lat":31.152545,"count":50},{"lng":120.652445,"lat":31.152545,"count":50}]
	    heatmapOverlay = new BMapLib.HeatmapOverlay({"radius":50});
	    map.addOverlay(heatmapOverlay);
	    heatmapOverlay.setDataSet({data:points,max:100});
	    heatmapOverlay.show();
	    
	    
        
    </script> 
{% endblock %}
